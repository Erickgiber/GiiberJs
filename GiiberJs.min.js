// --- Adding Variables ---
let audio, playbtn, mutebtn, seekslider, volumeslider, seeking, curtimetext, durtimetext, htmlHeaD, change;

// ยก--- Prinipal Function ---!
function initAudioPlayer() {
	// ---- ยก Adding Song ! ----
	audio = new Audio();
	audio.src = "./mp3/1.mp3";
	audio.loop = true;
	audio.autoplay = true;
	audio.play();


	// --- Set Object References ---
	playbtn = document.querySelector('#playpausebtn');
	mutebtn = document.querySelector('#mutebtn');
	seekslider = document.querySelector('#seekslider');
	volumeslider = document.querySelector('#volumeslider');
	curtimetext = document.querySelector('#curtimetext');
	durtimetext = document.querySelector('#durtimetext');

	htmlHeaD = document.querySelector('head');
	change = document.querySelector('#change');

	// --- Add Event references ---
	playbtn.addEventListener("click", playPause);

	mutebtn.addEventListener("click", mute);

	seekslider.addEventListener("mousedown", function(event) { seeking = true; seek(event); });
	seekslider.addEventListener("mousemove", function(event) { seek(event); });

	seekslider.addEventListener("mouseup", function() { seeking = false; });
	volumeslider.addEventListener("mousemove", setVolume)

	audio.addEventListener("timeupdate", function() {seektimeupdate(); })


	// --- Functions ---
	function playPause() {
		if (audio.paused) {
			audio.play();
		} else {
			audio.pause()
		};
	};


	function mute() {
		if (audio.muted) {
			audio.muted = false;
		} else {
			audio.muted = true;
		}
	};


	function setVolume() {
		audio.volume = volumeslider.value / 100;
	}


	function seek(event) {
		if (seeking) {
			seekslider.value = event.clientX - seekslider.offsetLeft;
			let seekto = audio.duration * (seekslider.value / 100);
			audio.currentTime = seekto;
		}
	}

	function seektimeupdate(){
		var nt = audio.currentTime * (100 / audio.duration);
		seekslider.value = nt;
		var curmins = Math.floor(audio.currentTime / 60);
	    var cursecs = Math.floor(audio.currentTime - curmins * 60);
	    var durmins = Math.floor(audio.duration / 60);
	    var dursecs = Math.floor(audio.duration - durmins * 60);
		if(cursecs < 10){ cursecs = "0"+cursecs; }
	    if(dursecs < 10){ dursecs = "0"+dursecs; }
	    if(curmins < 10){ curmins = "0"+curmins; }
	    if(durmins < 10){ durmins = "0"+durmins; }
		curtimetext.innerHTML = curmins+":"+cursecs;
	    durtimetext.innerHTML = durmins+":"+dursecs;
	}

	change.addEventListener('click', ()=> {
		audio.src = "./mp3/2.mp3";
		seekslider.value = 0 / 100;
	})
};

window.addEventListener("load", initAudioPlayer);
